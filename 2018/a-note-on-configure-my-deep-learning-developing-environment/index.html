

<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="oyiadin">

    <title>深度学习开发环境配置记录 (tf+torch) - oyiadin</title>
    <meta name="description" content="">

    <meta name="keywords"
          content="">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta name="renderer" content="webkit">
    <noscript>
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400|Montserrat|Anonymous+Pro:400|Material+Icons"/>
    </noscript>
    <link rel="short icon" href="../../favicon/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/mprogress.css">
    <link rel="stylesheet" href="../../css/open-iconic.min.css">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/prism.css">
    <link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="../../atom.xml">
    <script>
        /*!
         loadCSS: load a CSS file asynchronously.
         [c]2014 @scottjehl, Filament Group, Inc.
         Licensed MIT
         */
        function loadCSS( href, before, media ){
            "use strict";
            var ss = window.document.createElement( "link" );
            var ref = before || window.document.getElementsByTagName( "script" )[ 0 ];
            var sheets = window.document.styleSheets;
            ss.rel = "stylesheet";
            ss.href = href;
            ss.media = "only x";
            ref.parentNode.insertBefore( ss, ref );
            function toggleMedia(){
                var defined;
                for( var i = 0; i < sheets.length; i++ ){
                    if( sheets[ i ].href && sheets[ i ].href.indexOf( href ) > -1 ){
                        defined = true;
                    }
                }
                if( defined ){
                    ss.media = media || "all";
                }
                else {
                    setTimeout( toggleMedia );
                }
            }
            toggleMedia();
            return ss;
        }
    </script>
</head>
<body>

<div id="app">
    <nav ref="navBar" class="navbar fixed-top navbar-light">
    <div id="global-loading-indicator" class="progress-line global-loading-indicator"></div>
    <div id="nav_background" class="nav-background"></div>
    <div style="padding-left: 15px;padding-right: 15px" class="container container-narrow nav-content">

        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" data-toggle="adropdown">
            <span class="oi" data-glyph="menu"></span>
        </button>
        <a id="nav_title" class="navbar-brand Montserrat" href="/">
            oyiadin
        </a>
        <div class="float-right navbar-dark nav-icon-group">
            <div class="dropdown">
                <ul class="dropdown-menu" id="collapsed_nav">
                    <li><a href="/" class="a-block nav-icon">Archive</a></li>
                    
                    
                    <li><a href="/about/index.html" class="a-block nav-icon">About Me &amp; Links</a></li>
                    
                    
                    <li><a href="/atom.xml" target="_blank" class="a-block">
                            <span data-glyph="rss" class="oi nav-icon"></span>
                        </a>
                    </li>
                    
                </ul>
            </div>

        </div>
    </div>
</nav>
    <div class="container container-narrow">

        <div ref="pageHead"
             v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"
             class="page-head">
            <a href="/">
                <h2>oyiadin</h2>
                <h5>Shares anything interesting.</h5>
            </a>
        </div>

<div class="row stream-container">
    <div class="card-container">

        <div class="card card-item clear-border card-top-patch card-clear-hover">
            

            <div class="card-item-container clear-flex-xs">
                <div class="card-inner-cell">
                    <h2>深度学习开发环境配置记录 (tf+torch)</h2>

                    <div>
                        <p>
                            <time datetime="2018-07-26T16:00:00.000Z" itemprop="datePublished">
                                2018-07-27 00:00
                            </time>
                            

                            
                            
                            <span class="oi" data-glyph="tag" style="vertical-align: middle; margin-left: 5px"> </span>&nbsp;
                            
                            <a href='/tags/Tensorflow/'>Tensorflow</a>
                            
                            ,
                            
                            
                            <a href='/tags/Pytorch/'>Pytorch</a>
                            
                            ,
                            
                            
                            <a href='/tags/深度学习/'>深度学习</a>
                            
                            ,
                            
                            
                            <a href='/tags/开发环境/'>开发环境</a>
                            
                            ,
                            
                            
                            <a href='/tags/记录/'>记录</a>
                            
                            
                            
                        </p>
                    </div>


                    <p class=" post-block-desc">
                        <h3 id="Versions"><a href="#Versions" class="headerlink" title="Versions"></a>Versions</h3><ul>
<li>CPU: Intel i5-6300HQ (2.30GHz)</li>
<li><p>GPU: NVIDIA GeForce GTX 950M</p>
</li>
<li><p>Windows 10 Education</p>
</li>
<li><p>Ubuntu 16.04 LTS (VirtualBox 5.2.16)</p>
</li>
<li><p>Python</p>
<ul>
<li>Python 3.6.5 (Windows, Anaconda)</li>
<li>Python 3.5.2 (Ubuntu)</li>
</ul>
</li>
<li><p>Libraries</p>
<ul>
<li>numpy 1.15.0</li>
<li>pandas 0.23.3</li>
<li>tensorflow 1.9.0</li>
<li>torch 0.4.0</li>
<li>requests 2.9.1</li>
<li>beautifulsoup4 4.4.1</li>
</ul>
</li>
<li><p>CUDA Toolkit 9.0</p>
</li>
<li>cuDNN 7.0.5 (Dec 5, 2017), for CUDA 9.0</li>
</ul>
<h3 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h3><p>我的 ubuntu 一直都是配好的，不再赘述。为了便利，我选择使用 Anaconda，安装很容易，只需一路 Next 就行。numpy、pandas、requests 与 bs4 的安装也都很简单，<code>sudo pip3 install</code> 就能直接装上。由于 VBox 不能很好地利用我的显卡，我仅在 Windows 上安装了 GPU 版 Tensorflow，Ubuntu 上只安装了 CPU 版。</p>
<p><a href="https://www.tensorflow.org/install/install_windows#installing_with_native_pip" target="_blank" rel="noopener">安装 Tensorflow-GPU</a> 时遇到了一个问题：<code>Distributed 1.21.8 requires msgpack, which is not installed</code>，谷歌搜到<a href="https://stackoverflow.com/questions/51050257/distributed-1-21-8-requires-msgpack-which-is-not-installed" target="_blank" rel="noopener">这篇文章</a>，照做即可。不过在真正能够启动 Tensorflow-GPU 前需要安装好 CUDA Toolkit 跟 cuDNN。</p>
<p><a href="https://www.tensorflow.org/install/install_windows" target="_blank" rel="noopener">Tensorflow 的引导页</a> 所要求的 CUDA Toolkit 版本为 9.0，然而英伟达官网已经发布了 9.2，为了避免兼容问题，我从<a href="https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener">这里</a>找到了 v9.0，下载并安装之即可，<code>%PATH%</code> 它会自动设置好，但是没加全，还得自己加一条 <code>Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.0\extras\CUPTI\libx64</code>。</p>
<p>cuDNN 也有版本要求。同样，有一个 <a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener">Archive 页</a>可供下载，选择符合要求的最新版本 v7.0.5 (Dec 5, 2017), for CUDA 9.0，下载后解压，把 <code>cuDNN/bin/</code> 加到 <code>%PATH%</code> 里（下载需要先注册、登陆），重启 Python 即可。</p>
<p>装上 Tensorflow 后，我把官方提供的例子给克隆了下来，运行时发现数据总是导入失败（失败于 pd.read_csv）。奇怪的是，在 pandas 项目的 issue 页明明能搜到相关的问题，也早就被标记了“Solved”，可是我更新到最新版本（0.23.3）后还是没有解决。这个问题是因为默认路径有包含有中文（也就是我的系统用户名），最后我只能照着<a href="https://blog.csdn.net/qq_33530388/article/details/71739845" target="_blank" rel="noopener">这篇文章</a>，把我的系统用户名从中文改为英文。改完重启后，终于顺利跑完 <code>premade_estimator.py</code>。</p>
<p>改完用户名后其实有另外一个问题：VBox 找不到我的虚拟机文件了。要解决这个问题，只要在 <code>~/.VirtualBox</code> 里编辑 <code>VirtualBox.xml</code> 和 <code>VirtualBox.xml-prev</code>，把相应路径改为新的就行了。</p>
<p>但是，折腾完一跑代码我才发现，跑示例代码的时候，CPU 比 GPU 快多了…打扰了…我也不知道为什么。要用 CPU 跑的话，可以加上 <code>with tf.device(&#39;/cpu:0&#39;)</code>，但我觉得很麻烦，还得修改代码。其实只需要在跑脚本前敲一行 <code>set CUDA_VISIBLE_DEVICES=-1</code> 设置一下环境变量就行了，或者在脚本开头加上：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'CUDA_VISIBLE_DEVICES'</span>] = <span class="string">'-1'</span></span><br></pre></td></tr></table></figure>
<p>Pytorch 的安装则直接两行命令搞定：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">conda install pytorch cuda90 -c pytorch</span><br><span class="line">pip install torchvision</span><br></pre></td></tr></table></figure>
<p>包比较大（接近 600M），建议科学上网。装完后我试着跑了一下官方给的 <a href="https://github.com/pytorch/examples/blob/master/mnist/main.py" target="_blank" rel="noopener">MNIST 示例代码</a>，发现跑不起来，在 49 行报了错。随即去看了这个文件的 <a href="https://github.com/pytorch/examples/blame/master/mnist/main.py#L49" target="_blank" rel="noopener">Blame 页</a>，发现就在我写这篇报告的十二小时前刚有一个<a href="https://github.com/pytorch/examples/commit/75e7c75469d21cb76ada070058889124b850a632" target="_blank" rel="noopener">新的 commit</a>，改回去就可以了。这段代码跑起来能明显感到 GPU 对训练速度的提升，估计效率比 CPU 高了两倍以上。</p>

                    </p>

                    <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="../deep-learning-univariate-linear-regression/">
        Previous post: 用Tensorflow实现简单的单变量线性回归
    </a>
    
    <span class="page-number"></span>
    
    <a class="older-posts" href="../writeup-of-hgame-week4/">
        Next post: HGAME Week4 Writeup
    </a>
    
</nav>

                    
                </div>
            </div>
        </div>
    </div>
</div>

<footer>
    <p>
        &copy;&nbsp;2018&nbsp;<a target="_blank"
                                                               href="">oyiadin</a>
    </p>

    
    <p>Theme&nbsp;<a target="_blank"
                     href="https://github.com/SumiMakito/hexo-theme-journal">Journal.</a>&nbsp;by&nbsp;<a
                target="_blank" href="https://www.keep.moe">Makito</a>
    </p>
    

    <p>
        Proudly published with&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>
    </p>
</footer>

</div>
</div>
</div>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="../../js/popper.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src=" ../../js/vue.min.js"></script>
<script src=" ../../js/journal.js"></script>
<script>
    loadCSS("//fonts.googleapis.com/css?family=Source+Sans+Pro:400|Montserrat|Anonymous+Pro:400|Material+Icons");
</script>


<script>
    $(document).ready(function () {
        $("#global-loading-indicator").fadeOut(600);
    });
</script>

</body>
</html>
