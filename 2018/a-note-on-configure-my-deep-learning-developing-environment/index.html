<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="深度学习开发环境配置记录 (tf+torch)Versions CPU: Intel i5-6300HQ (2.30GHz) GPU: NVIDIA GeForce GTX 950M  Windows 10 Education  Ubuntu 16.04 LTS (VirtualBox 5.2.16)  Python  Python 3.6.5 (Windows, Anaconda) Python">
<meta name="keywords" content="Tensorflow,Pytorch,深度学习,开发环境,记录">
<meta property="og:type" content="article">
<meta property="og:title" content="深度学习开发环境配置记录 (tf+torch)">
<meta property="og:url" content="https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/index.html">
<meta property="og:site_name" content="oyiadin">
<meta property="og:description" content="深度学习开发环境配置记录 (tf+torch)Versions CPU: Intel i5-6300HQ (2.30GHz) GPU: NVIDIA GeForce GTX 950M  Windows 10 Education  Ubuntu 16.04 LTS (VirtualBox 5.2.16)  Python  Python 3.6.5 (Windows, Anaconda) Python">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-07-28T14:50:12.828Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深度学习开发环境配置记录 (tf+torch)">
<meta name="twitter:description" content="深度学习开发环境配置记录 (tf+torch)Versions CPU: Intel i5-6300HQ (2.30GHz) GPU: NVIDIA GeForce GTX 950M  Windows 10 Education  Ubuntu 16.04 LTS (VirtualBox 5.2.16)  Python  Python 3.6.5 (Windows, Anaconda) Python">
    
    
        
          
              <link rel="shortcut icon" href="../../images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="../../images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>深度学习开发环境配置记录 (tf+torch)</title>
    <!-- styles -->
    <link rel="stylesheet" href="../../css/style.css">
    <!-- rss -->
    
    
      <link rel="alternate" href="../../atom.xml" title="oyiadin" type="application/atom+xml" />
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#" class="active"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" class="active"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu" style="visibility: visible;">
    <span id="nav">
      <ul>
         
          <li><a href="../../index.html">Home</a></li>
         
          <li><a href="../../archives/">Archives</a></li>
         
          <li><a href="../../about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="../writeup-of-hgame-week4/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous Post</span>
      <span id="i-next" class="info" style="display:none;">Next Post</span>
      <span id="i-top" class="info" style="display:none;">Back To Top</span>
      <span id="i-share" class="info" style="display:none;">Share Post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&text=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&is_video=false&description=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=深度学习开发环境配置记录 (tf+torch)&body=Check out this article: https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&name=深度学习开发环境配置记录 (tf+torch)&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#深度学习开发环境配置记录-tf-torch"><span class="toc-number">1.</span> <span class="toc-text">深度学习开发环境配置记录 (tf+torch)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Versions"><span class="toc-number">1.1.</span> <span class="toc-text">Versions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Details"><span class="toc-number">1.2.</span> <span class="toc-text">Details</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        深度学习开发环境配置记录 (tf+torch)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">oyiadin</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-07-26T16:00:00.000Z" itemprop="datePublished">2018-07-27</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="../../tags/Pytorch/">Pytorch</a>, <a class="tag-link" href="../../tags/Tensorflow/">Tensorflow</a>, <a class="tag-link" href="../../tags/开发环境/">开发环境</a>, <a class="tag-link" href="../../tags/深度学习/">深度学习</a>, <a class="tag-link" href="../../tags/记录/">记录</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="深度学习开发环境配置记录-tf-torch"><a href="#深度学习开发环境配置记录-tf-torch" class="headerlink" title="深度学习开发环境配置记录 (tf+torch)"></a>深度学习开发环境配置记录 (tf+torch)</h1><h2 id="Versions"><a href="#Versions" class="headerlink" title="Versions"></a>Versions</h2><ul>
<li>CPU: Intel i5-6300HQ (2.30GHz)</li>
<li><p>GPU: NVIDIA GeForce GTX 950M</p>
</li>
<li><p>Windows 10 Education</p>
</li>
<li><p>Ubuntu 16.04 LTS (VirtualBox 5.2.16)</p>
</li>
<li><p>Python</p>
<ul>
<li>Python 3.6.5 (Windows, Anaconda)</li>
<li>Python 3.5.2 (Ubuntu)</li>
</ul>
</li>
<li><p>Libraries</p>
<ul>
<li>numpy 1.15.0</li>
<li>pandas 0.23.3</li>
<li>tensorflow 1.9.0</li>
<li>torch 0.4.0</li>
<li>requests 2.9.1</li>
<li>beautifulsoup4 4.4.1</li>
</ul>
</li>
<li><p>CUDA Toolkit 9.0</p>
</li>
<li>cuDNN 7.0.5 (Dec 5, 2017), for CUDA 9.0</li>
</ul>
<h2 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h2><p>我的 ubuntu 一直都是配好的，不再赘述。为了便利，我选择使用 Anaconda，安装很容易，只需一路 Next 就行。numpy、pandas、requests 与 bs4 的安装也都很简单，<code>sudo pip3 install</code> 就能直接装上。由于 VBox 不能很好地利用我的显卡，我仅在 Windows 上安装了 GPU 版 Tensorflow，Ubuntu 上只安装了 CPU 版。</p>
<p><a href="https://www.tensorflow.org/install/install_windows#installing_with_native_pip" target="_blank" rel="noopener">安装 Tensorflow-GPU</a> 时遇到了一个问题：<code>Distributed 1.21.8 requires msgpack, which is not installed</code>，谷歌搜到<a href="https://stackoverflow.com/questions/51050257/distributed-1-21-8-requires-msgpack-which-is-not-installed" target="_blank" rel="noopener">这篇文章</a>，照做即可。不过在真正能够启动 Tensorflow-GPU 前需要安装好 CUDA Toolkit 跟 cuDNN。</p>
<p><a href="https://www.tensorflow.org/install/install_windows" target="_blank" rel="noopener">Tensorflow 的引导页</a> 所要求的 CUDA Toolkit 版本为 9.0，然而英伟达官网已经发布了 9.2，为了避免兼容问题，我从<a href="https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener">这里</a>找到了 v9.0，下载并安装之即可，<code>%PATH%</code> 它会自动设置好，但是没加全，还得自己加一条 <code>Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9.0\extras\CUPTI\libx64</code>。</p>
<p>cuDNN 也有版本要求。同样，有一个 <a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener">Archive 页</a>可供下载，选择符合要求的最新版本 v7.0.5 (Dec 5, 2017), for CUDA 9.0，下载后解压，把 <code>cuDNN/bin/</code> 加到 <code>%PATH%</code> 里（下载需要先注册、登陆），重启 Python 即可。</p>
<p>装上 Tensorflow 后，我把官方提供的例子给克隆了下来，运行时发现数据总是导入失败（失败于 pd.read_csv）。奇怪的是，在 pandas 项目的 issue 页明明能搜到相关的问题，也早就被标记了“Solved”，可是我更新到最新版本（0.23.3）后还是没有解决。这个问题是因为默认路径有包含有中文（也就是我的系统用户名），最后我只能照着<a href="https://blog.csdn.net/qq_33530388/article/details/71739845" target="_blank" rel="noopener">这篇文章</a>，把我的系统用户名从中文改为英文。改完重启后，终于顺利跑完 <code>premade_estimator.py</code>。</p>
<p>改完用户名后其实有另外一个问题：VBox 找不到我的虚拟机文件了。要解决这个问题，只要在 <code>~/.VirtualBox</code> 里编辑 <code>VirtualBox.xml</code> 和 <code>VirtualBox.xml-prev</code>，把相应路径改为新的就行了。</p>
<p>但是，折腾完一跑代码我才发现，跑示例代码的时候，CPU 比 GPU 快多了…打扰了…我也不知道为什么。要用 CPU 跑的话，可以加上 <code>with tf.device(&#39;/cpu:0&#39;)</code>，但我觉得很麻烦，还得修改代码。其实只需要在跑脚本前敲一行 <code>set CUDA_VISIBLE_DEVICES=-1</code> 设置一下环境变量就行了，或者在脚本开头加上：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'CUDA_VISIBLE_DEVICES'</span>] = <span class="string">'-1'</span></span><br></pre></td></tr></table></figure>
<p>Pytorch 的安装则直接两行命令搞定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch cuda90 -c pytorch</span><br><span class="line">pip install torchvision</span><br></pre></td></tr></table></figure>
<p>包比较大（接近 600M），建议科学上网。装完后我试着跑了一下官方给的 <a href="https://github.com/pytorch/examples/blob/master/mnist/main.py" target="_blank" rel="noopener">MNIST 示例代码</a>，发现跑不起来，在 49 行报了错。随即去看了这个文件的 <a href="https://github.com/pytorch/examples/blame/master/mnist/main.py#L49" target="_blank" rel="noopener">Blame 页</a>，发现就在我写这篇报告的十二小时前刚有一个<a href="https://github.com/pytorch/examples/commit/75e7c75469d21cb76ada070058889124b850a632" target="_blank" rel="noopener">新的 commit</a>，改回去就可以了。这段代码跑起来能明显感到 GPU 对训练速度的提升，估计效率比 CPU 高了两倍以上。</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="../../index.html">Home</a></li>
         
          <li><a href="../../archives/">Archives</a></li>
         
          <li><a href="../../about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#深度学习开发环境配置记录-tf-torch"><span class="toc-number">1.</span> <span class="toc-text">深度学习开发环境配置记录 (tf+torch)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Versions"><span class="toc-number">1.1.</span> <span class="toc-text">Versions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Details"><span class="toc-number">1.2.</span> <span class="toc-text">Details</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&text=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&is_video=false&description=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=深度学习开发环境配置记录 (tf+torch)&body=Check out this article: https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&title=深度学习开发环境配置记录 (tf+torch)"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://oyiadin.github.io/2018/a-note-on-configure-my-deep-learning-developing-environment/&name=深度学习开发环境配置记录 (tf+torch)&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 oyiadin
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="../../index.html">Home</a></li>
         
          <li><a href="../../archives/">Archives</a></li>
         
          <li><a href="../../about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="../../lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="../../lib/meslo-LG/styles.css">
<link rel="stylesheet" href="../../lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="../../lib/jquery/jquery.min.js"></script>
<script src="../../lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="../../js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'oyiadin';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


